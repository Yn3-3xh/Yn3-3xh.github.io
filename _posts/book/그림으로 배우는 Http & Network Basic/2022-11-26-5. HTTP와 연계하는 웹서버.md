---
title: "[Book - 그림으로 배우는 Http & Network Basic]<br>5. HTTP와 연계하는 웹서버"
date : 2022-11-26 19:00:00 +09:00
categories : [Book - 그림으로 배우는 Http & Network Basic]
tags : [book, Http, Network, Web Server, Proxy, Gateway, Tunnel, Cache]
---

# 한 대로 멀티 도메인을 가능하게 하는 가상 호스트

---

웹 호스트팅을 제공하고 있는 사업자는 1대의 서버에 여러 고객의 웹 사이트를 넣을 수 있다.

고객마다 다른 도메인을 가지고, 다른 웹 사이트를 실행할 수 있다.

이를 위해 **가상 호스트(Virtual Host)**라는 기능을 사용하고 있다.

가상 호스트 기능을 사용하면 **물리적으로는 서버가 1대지만 가상으로 여러대가 있는 것처럼 설정하는 것이 가능**하다.

인터넷에서 도메인명은 DNS에 의해서 IP 주소로 변환되고 나서 액세스하게 된다.

같은 IP 주소에서 다른 호스트명과 도메인 명을 가진 여러 개의 웹 사이트가 실행되고 있는 가상 호스트의 시스템이 있기 때문에 **HTTP Request를 보내는 경우에는 호스트명과 도메인 명을 완전하게 포함한 URI를 지정하거나, 반드시 Host 헤더 필드에서 지정**해야 한다.

# 통신을 중계하는 프로그램: 프록시, 게이트웨이, 터널

---

아래와 같은 프로그램과 서버는 그 다음에 있는 다른 서버에 Request를 중계하고, 그 서버로부터 받은 Response를 클라이언트에 반환하는 역할을 담당한다.

- 프록시
    
    서버와 클라이언트의 양쪽 역할을 하는 중계 프로그램
    
    클라이언트로부터의 Request를 서버에 전송하고, 서버로부터의 Response를 클라이언트에 전송한다.
    
- 게이트웨이
    
    다른 서버를 중계하는 서버
    
    클라이언트로부터 수신한 Request를 리소스를 보유한 서버인 것처럼 수신한다.
    
    경우에 따라서는 클라이언트는 상대가 게이트웨이라는 것을 알지 못하는 경우도 있다.
    
- 터널
    
    서로 떨어진 두 대의 클라이언트와 서버 사이를 중계하며 접속을 주선하는 중계 프로그램이다.
    

## 프록시

- 프록시 서버의 기본 동작
    
    ![프록시 서버](https://drive.google.com/uc?id=1sdHYCqt_fCm7hYmHXKMjgKMOWHPetHJY){: width="80%" height="80%"}
    
    클라이언트로부터 받은 Request를 다른 서버에 전송하는 것이다.
    
    클라이언트로부터 받은 Request URI를 변경하지 않고 그 다음의 리소스를 가지고 있는 서버에 보낸다.
    
    > 오리진 서버(Origin Server)<br>
    > 리소스 본체를 가진 서버이며, 오리진 서버로부터 되돌아온 Response는 프록시 서버를 경유해서 클라이언트에 돌아온다.

- 프록시 서버를 여러 대 경유
    
    ![프록시 서버 여러 대 경우](https://drive.google.com/uc?id=1kO_DF8KMagOqwqhVBhlV3oaE3nIpT6jW){: width="80%" height="80%"}
    
    체인과 같이 여러 대 경유해서 Request와 Response를 중계해 간다.
    
    중계할 때에는 Via 헤더 필드에 경유한 로스트 정보를 추가해야 한다.
    
- 프록시 서버를 사용하는 추가적인 이유
    - 캐시를 사용해서 네트워크 대역 등을 효율적으로 사용하는 것
    - 조직 내에 특정 웹 사이트에 대한 액세스 제한, 액세스 로그를 획득하는 정책을 철저하게 지키려는 목적

- 프록시 사용 방법
    - 캐시하는지 안하는지 여부로 구분
    - 메시지를 변경하는지 안하는지로 구분

### 캐싱 프록시 (Cashing Proxy)

프록시로 Response를 중계할 때 프록시 서버 상에 리소스 캐시를 보존해 두는 타입의 프록시이다.

### 투명 프록시 (Transparent Proxy)

프록시로 Request와 Response를 중계할 때 메시지 변경을 하지 않는 타입의 프록시이다.

> 반대로 메시지에 변경을 가하는 타입의 프로시는 비투과 프록시라고 한다.

## 게이트웨이

게이트웨이의 동작은 프록시와 매우 유사하다.

![게이트웨이](https://drive.google.com/uc?id=1ARm1h7cIEQKlzsT8A2HMSTsVxa0KMTkE){: width="80%" height="80%"}

게이트웨이의 경우에는 그 다음에 있는 서버가 HTTP 서버 이외의 서비스를 제공하는 서버가 된다.

**클라이언트와 게이트웨이 사이를 암호화**하는 등으로 안전하게 접속함으로써 **통신의 안전성**을 높이는 역할 등을 한다.

## 터널

터널은 요구에 따라서 다른 서버와의 통신 경로를 확립한다. 이 때 **클라이언트는 SSL 같은 암호화 통신을 통해 서버와 안전하게 통신을 하기 위해 사용**한다.

![터널](https://drive.google.com/uc?id=1-9DTC6R6XwxQpDxfNPZt2dZCIF_Jz6tf){: width="80%" height="80%"}

터널 자체는 HTTP Request를 해석하려고 하지 않는다. 결국 Request를 그대로 다음 서버에 중계하고 **터널은 통신하고 있는 양쪽 끝의 접속이 끊어질 때 종료**한다.

> 터널 자체는 투명한 존재이기 때문에 클라이언트는 너무 의식할 필요가 없다.

# 리소스를 보관하는 캐시

---

캐시(Cache)는 프록시 서버와 클라이언트의 로컬 디스크에 보관된 리소스의 사본을 가리킨다.

캐시를 사용하면 리소스를 가진 서버의 액세스를 줄일 수 있어서 **통신량과 통신 시간을 절약**할 수 있다.

캐시 서버는 프록시 서버의 하나로 캐싱 프록시로 분류된다. 결국, 프록시가 서버로부터 Response를 중계할 때 프록시 서버 상에 리소스의 사본을 보존한다.

- 캐시 서버의 장점
    
    캐시를 이용함으로써 같은 데이터를 몇 번이고 오리진 서버에 전송할 필요가 없다.
    
    클라이언트는 네트워크에서 가까운 서버로부터 리소스를 얻을 수 있게 되어 **서버는 같은 Request를 매번 처리하지 않아도 된다.**
    

## 캐시는 유효기간이 있다.

![캐시 서버](https://drive.google.com/uc?id=1Hs0zjNoR5NG-qT6U6lmGFOe7MM45J3ds){: width="70%" height="70%"}

캐시 서버에 캐시가 있어도 리소스의 Request에 대해서 항상 캐시를 돌려 준다고는 할 수 없다. 이것은 캐시되어 있는 리소스의 유효성과 관계가 있다.

## 클라이언트 측에도 캐시가 있다.

캐시 서버만 캐시를 가지고 있는 게 아니라 클라이언트가 사용하고 있는 브라우저에서도 캐시를 가질 수 있다.

브라우저가 유효한 캐시를 가지고 있는 경우 같은 리소스의 액세스는 서버에 액세스하지 않고 로컬 디스크로부터 불러온다.

> 리소스가 오랜된 것으로 판단된 경우에는 캐시 서버와 동일하다.
